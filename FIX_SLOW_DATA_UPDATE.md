# データ更新が遅い問題の修正

## 問題

LINE Botで「データ更新」コマンドを実行すると、処理に時間がかかりすぎて、LINE Botの30秒タイムアウトに引っかかる可能性があります。

## 修正内容

### 1. 即座に応答を返す

「データ更新」コマンドを受信したら、即座に「処理中です...」というメッセージを返すようにしました。これにより、LINE Botのタイムアウトを回避できます。

### 2. 処理を簡略化

- **データ期間を短縮**: 7日分 → 3日分（処理時間短縮）
- **Dukascopyをスキップ**: Yahoo Financeのみを使用（より確実で高速）
- **イベントデータをスキップ**: 高速化のため（オプション）
- **タイムアウトを短縮**: 300秒 → 180秒（各処理）

### 3. エラーメッセージを改善

エラーメッセージを短縮し、ユーザーに再試行を促すメッセージを追加しました。

## 使用方法

1. LINE Botで「データ更新」と送信
2. 即座に「🔄 データ更新を開始しました。処理中です...」というメッセージが返ってきます
3. 数分待つ（バックグラウンドで処理が実行されます）
4. 「分析」コマンドを試して、データが更新されているか確認

## 注意事項

- 処理はバックグラウンドで実行されるため、完了通知はありません
- 処理が完了したかどうかは、「分析」コマンドで確認してください
- 処理に失敗した場合は、数分待ってから再度「データ更新」を試してください

## トラブルシューティング

### まだエラーが発生する場合

1. **Renderのログを確認**:
   - Render Dashboard → Logsタブ
   - エラーメッセージを確認

2. **処理時間を確認**:
   - ログで各処理の実行時間を確認
   - タイムアウトが発生していないか確認

3. **データ期間をさらに短縮**:
   - `app.py`の`update_data()`関数で`days=3`を`days=1`に変更

## 次のステップ

修正をデプロイしたら：

1. ✅ LINE Botで「データ更新」コマンドをテスト
2. ✅ 即座に応答が返ってくることを確認
3. ✅ 数分後に「分析」コマンドでデータが更新されているか確認
